# NFL Wallet Helm Chart

Deploys the NFL Stadium Wallet stack: **webapp** (Vue frontend) and three APIs (**api-customers**, **api-bills**, **api-raiders**) with the following layout:

| Service        | Service Port | Pod (container) Port |
|----------------|--------------|------------------------|
| api-customers  | 8080         | 8080                  |
| api-bills      | 8081         | 8080                  |
| api-raiders    | 8082         | 8080                  |
| webapp         | 5173         | 8080                  |

## Prerequisites

- Images built and pushed to Quay (see repo root `build-push-quay.sh`)
- Kubernetes 1.19+
- Helm 3

## Install

```bash
# Add namespace if needed
kubectl create namespace nfl-wallet

# Install with default values (Quay namespace: maximilianopizarro).
# On OpenShift a Route for the webapp is created by default (webapp.route.enabled: true).
helm install nfl-wallet ./helm/nfl-wallet -n nfl-wallet

# Disable the webapp Route (no autogenerated Route)
helm install nfl-wallet ./helm/nfl-wallet -n nfl-wallet --set webapp.route.enabled=false

# Enable Routes for the three APIs as well (so you get four Routes and can set API URLs)
helm install nfl-wallet ./helm/nfl-wallet -n nfl-wallet --set apiRoutes.enabled=true

# Set API URLs for the browser (avoids "Unexpected token '<'" — each must end with /api)
helm install nfl-wallet ./helm/nfl-wallet -n nfl-wallet \
  --set webapp.apiCustomersUrl=https://api-customers.YOUR_DOMAIN/api \
  --set webapp.apiBillsUrl=https://api-bills.YOUR_DOMAIN/api \
  --set webapp.apiRaidersUrl=https://api-raiders.YOUR_DOMAIN/api
```

## Values

| Key | Description | Default |
|-----|-------------|---------|
| `imageNamespace` | Quay.io namespace for images | `maximilianopizarro` |
| `apiRoutes.enabled` | Create OpenShift Routes for the three APIs | `false` |
| `apiCustomers.image` / `tag` | api-customers image | `nfl-wallet-api-customers:latest` |
| `apiBills.image` / `tag` | api-bills image | `nfl-api-bills:latest` |
| `apiRaiders.image` / `tag` | api-raiders image | `nfl-wallet-api-raiders:latest` |
| `webapp.image` / `tag` | webapp image | `nfl-wallet-webapp:latest` |
| `webapp.route.enabled` | Create OpenShift Route for webapp | `true` |
| `webapp.route.host` | Override Route host | `""` |
| `webapp.apiCustomersUrl` | Base URL for Customers API (browser, end with /api) | `""` |
| `webapp.apiBillsUrl` | Base URL for Bills API (browser, end with /api) | `""` |
| `webapp.apiRaidersUrl` | Base URL for Raiders API (browser, end with /api) | `""` |
| `*.persistence.enabled` | Use PVC for SQLite data | `true` |

**"Unexpected token '<', \"<!DOCTYPE\"... is not valid JSON"** — The app requests API data; if the three API URLs are empty it calls the webapp host and receives `index.html`. Set `webapp.apiCustomersUrl`, `webapp.apiBillsUrl`, and `webapp.apiRaidersUrl` to your API Route URLs (each ending with `/api`) and upgrade the release.

## Uninstall

```bash
helm uninstall nfl-wallet -n nfl-wallet
```
